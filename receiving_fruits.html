<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>과일 받기 게임</title>
<style>
  html,body{margin:0;height:100%;overflow:hidden;background:#071229;font-family:sans-serif;}
  canvas{display:block;width:100vw;height:100vh;}
  #score {position:fixed;top:12px;left:12px;font-size:24px;color:#fff;z-index:50;}
  #gameOver {position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);color:#fff;font-size:32px;display:none;text-align:center;}
  #gameOver button{margin-top:12px;padding:10px 18px;font-size:16px;cursor:pointer;}
</style>
</head>
<body>
<div id="score">Score: 0</div>
<div id="gameOver">
  Game Over<br/>
  <button id="restartBtn">Restart</button>
</div>
<canvas id="c"></canvas>
<script>
const canvas=document.getElementById('c');
const ctx=canvas.getContext('2d');
let W=innerWidth,H=innerHeight;
canvas.width=W;canvas.height=H;
window.addEventListener('resize',()=>{W=innerWidth;H=innerHeight;canvas.width=W;canvas.height=H;});

let score=0,combo=0,running=false;
const scoreEl=document.getElementById('score');
const gameOverDiv=document.getElementById('gameOver');
const restartBtn=document.getElementById('restartBtn');
restartBtn.addEventListener('click',()=>startGame());

const gravity=900; // px/sec^2
const fruits=[];
const basket={x:W/2,y:H-80,w:160,h:40};
const maxFruits=50;

function rand(a,b){return a+Math.random()*(b-a);}
function choose(arr){return arr[Math.floor(Math.random()*arr.length)];}

function spawnFruit(){
  if(fruits.length>=maxFruits) return;
  const types=[
    {color:'#ff4d4f',score:10},
    {color:'#ff9f1c',score:8},
    {color:'#7efc82',score:6},
    {color:'#ffd166',score:5},
    {color:'#61d0a6',score:12}
  ];
  const meta=choose(types);
  fruits.push({
    x:rand(40,W-40),
    y:-60,
    r:rand(22,34),
    vx:rand(-60,60),
    vy:rand(0,40),
    color:meta.color,
    score:meta.score,
    alive:true
  });
}

function update(dt){
  // spawn
  if(running && Math.random()<0.02) spawnFruit();
  
  for(let i=0;i<fruits.length;i++){
    const f=fruits[i];
    if(!f.alive) continue;
    f.vy+=gravity*dt;
    f.x+=f.vx*dt;
    f.y+=f.vy*dt;

    // collide with basket
    if(f.y+f.r >= basket.y && f.y+f.r <= basket.y+basket.h && f.x > basket.x-basket.w/2 && f.x < basket.x+basket.w/2){
      f.alive=false;
      score+=f.score;
      combo++;
      scoreEl.textContent=`Score: ${score} (Combo: ${combo})`;
    }

    // collide with floor (game over line)
    if(f.y+f.r >= H){
      running=false;
      gameOverDiv.style.display='block';
    }

    // simple fruit-fruit collision
    for(let j=i+1;j<fruits.length;j++){
      const g=fruits[j];
      if(!g.alive) continue;
      const dx=g.x-f.x,dy=g.y-f.y;
      const dist=Math.hypot(dx,dy);
      const minDist=f.r+g.r;
      if(dist<minDist && dist>0){
        const angle=Math.atan2(dy,dx);
        const overlap=minDist-dist;
        const shift=overlap/2;
        f.x-=Math.cos(angle)*shift; f.y-=Math.sin(angle)*shift;
        g.x+=Math.cos(angle)*shift; g.y+=Math.sin(angle)*shift;
        // bounce velocities
        const bounce=0.7;
        const fx=f.vx,fv=f.vy;
        f.vx=g.vx*bounce; f.vy=g.vy*bounce;
        g.vx=fx*bounce; g.vy=fv*bounce;
      }
    }
  }

  // remove dead fruits
  for(let i=fruits.length-1;i>=0;i--) if(!fruits[i].alive) fruits.splice(i,1);
}

function draw(){
  ctx.clearRect(0,0,W,H);
  // basket
  ctx.fillStyle='#fff';
  ctx.fillRect(basket.x-basket.w/2,basket.y,basket.w,basket.h);
  // fruits
  for(const f of fruits){
    ctx.fillStyle=f.color;
    ctx.beginPath();
    ctx.arc(f.x,f.y,f.r,0,Math.PI*2);
    ctx.fill();
  }
}

function loop(ts){
  const now=ts||performance.now();
  const dt=Math.min(0.033,(now-lastTime)/1000);
  lastTime=now;
  if(running){
    update(dt);
  }
  draw();
  requestAnimationFrame(loop);
}
let lastTime=performance.now();
requestAnimationFrame(loop);

function startGame(){
  running=true;
  fruits.length=0;
  score=0;combo=0;
  scoreEl.textContent='Score: 0';
  gameOverDiv.style.display='none';
  basket.x=W/2;
}

// pointer control for basket
let active=false;
canvas.addEventListener('mousedown',e=>{active=true; basket.x=e.clientX;});
canvas.addEventListener('mousemove',e=>{if(active) basket.x=e.clientX;});
canvas.addEventListener('mouseup',e=>{active=false;});
canvas.addEventListener('touchstart',e=>{active=true;basket.x=e.touches[0].clientX;}, {passive:false});
canvas.addEventListener('touchmove',e=>{active=true;basket.x=e.touches[0].clientX;}, {passive:false});
canvas.addEventListener('touchend',e=>{active=false;}, {passive:false});

startGame();
</script>
</body>
</html>
